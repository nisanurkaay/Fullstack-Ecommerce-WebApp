<div class="my-products-container">

  <!-- Filter Form -->
  <div class="filter-form mb-4">
    <!-- Category Filter -->
    <select [(ngModel)]="selectedCategory">
      <option [ngValue]="null">TÃ¼m Kategoriler</option>
      <option *ngFor="let c of categories" [ngValue]="c.id">{{ c.name }}</option>
    </select>

    <!-- Color Filters -->
    <div class="color-filters">
      <label *ngFor="let color of availableColors">
        <input type="checkbox" [value]="color" (change)="toggleColor(color)" [checked]="selectedColors.includes(color)" /> {{ color }}
      </label>
    </div>

    <!-- Size Filters -->
    <div class="size-filters">
      <label *ngFor="let size of availableSizes">
        <input type="checkbox" [value]="size" (change)="toggleSize(size)" [checked]="selectedSizes.includes(size)" /> {{ size }}
      </label>
    </div>

    <!-- Filter Button -->
    <button (click)="applyFilters()" class="btn-primary">Filtrele</button>
  </div>

  <h2 class="form-title">My Products</h2>

  <!-- Filter Buttons -->
  <div class="filter-buttons">
    <button (click)="setFilter('ALL')" [class.active-filter]="filter === 'ALL'">All</button>
    <button (click)="setFilter('ACTIVE')" [class.active-filter]="filter === 'ACTIVE'">Active</button>
    <button (click)="setFilter('INACTIVE')" [class.active-filter]="filter === 'INACTIVE'">Inactive</button>
    <button (click)="setFilter('PENDING')" [class.active-filter]="filter === 'PENDING'">Pending</button>
  </div>

  <!-- Button to Toggle Variant Display -->
  <div class="flex justify-end mb-2">
    <button (click)="showVariantsAsProducts = !showVariantsAsProducts" class="btn-secondary">
      {{ showVariantsAsProducts ? 'VaryantlarÄ± Grupla' : 'VaryantlarÄ± ÃœrÃ¼n Gibi GÃ¶ster' }}
    </button>
  </div>

  <!-- Product Table -->
  <div class="table-wrapper">
    <table class="custom-table">
      <thead>
        <tr>
          <th>Product</th>
          <th>Status</th>
          <th>Stock</th>
          <th>Price</th>
          <th>Category</th>
          <th>Variants</th>
          <th colspan="2">Actions</th>
        </tr>
      </thead>
      <tbody>
        <!-- Loop through filtered products -->
        <ng-container *ngFor="let p of filteredProducts">
          <tr>
            <td>
              {{ p.name }}
              <div class="flex gap-2 mt-1" *ngIf="!p.variants?.length">
                <!-- Display product images if no variants -->
                <img *ngFor="let img of p.imageUrls" [src]="'http://localhost:8081' + img" alt="Product image" class="thumbnail" />
              </div>
            </td>
            <td>{{ p.productStatus }}</td>
            <td>{{ p.stockQuantity }}</td>
            <td>{{ p.price | currency }}</td>
            <td>{{ p.categoryName }}</td>
            <td>
              <button *ngIf="p.variants?.length" (click)="toggleVariants(p.id!)" class="btn-outline">
                {{ isExpanded(p.id!) ? 'Hide' : 'Show' }}
              </button>
              <span *ngIf="hasVaryingPrices(p)" class="price-alert">ðŸ’¡</span>
            </td>
            <td>
              <button *ngIf="p.productStatus === 'ACTIVE'" (click)="deactivateProduct(p.id!)" class="btn-danger">KaldÄ±r</button>
              <button *ngIf="p.productStatus === 'INACTIVE' && p.stockQuantity > 0" (click)="activateProduct(p.id!)" class="btn-success">YayÄ±na Al</button>
            </td>
            <td>
              <button (click)="editProduct(p)" class="btn-secondary">DÃ¼zenle</button>
              <button (click)="confirmDeleteProduct(p.id!)" class="btn-danger">Sil</button>
            </td>
          </tr>

          <!-- Variant Details -->
          <ng-container *ngIf="isExpanded(p.id!) && p.variants?.length">
            <tr *ngFor="let v of p.variants">
              <td colspan="8" class="variant-row">
                <div class="variant-box">
                  <p><strong>Varyant:</strong> Renk: {{ v.color }}, Beden: {{ v.size }}, Fiyat: {{ v.price | currency }}, Stok: {{ v.stock }}</p>
                  <div class="flex gap-2 mt-1">
                    <img *ngFor="let img of v.imageUrls" [src]="img" alt="Variant image" class="thumbnail" />
                  </div>
                  <button (click)="confirmDeleteVariant(p.id!, v.id!)" class="btn-danger mt-2">VaryantÄ± Sil</button>
                </div>
              </td>
            </tr>
          </ng-container>
        </ng-container>
      </tbody>
    </table>
  </div>

  <!-- No Products Found -->
  <p *ngIf="filteredProducts.length === 0" class="no-products">No products found for this filter.</p>
</div>
