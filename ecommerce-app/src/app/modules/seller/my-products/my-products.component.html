<div class="my-products-container">
  <h2 class="form-title">My Products</h2>

  <div class="filter-buttons">
    <button (click)="setFilter('ALL')" [class.active-filter]="filter === 'ALL'">All</button>
    <button (click)="setFilter('ACTIVE')" [class.active-filter]="filter === 'ACTIVE'">Active</button>
    <button (click)="setFilter('INACTIVE')" [class.active-filter]="filter === 'INACTIVE'">Inactive</button>
    <button (click)="setFilter('PENDING')" [class.active-filter]="filter === 'PENDING'">Pending</button>
  </div>

  <div class="table-wrapper">
    <table class="custom-table">
      <thead>
        <tr>
          <th>Product</th>
          <th>Status</th>
          <th>Stock</th>
          <th>Price</th>
          <th>Category</th>
          <th>Variants</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let p of filteredProducts">
          <!-- Ana ÃœrÃ¼n -->
          <tr>
            <td>
              {{ p.name }}
              <div class="flex gap-2 mt-1" *ngIf="!p.variants?.length">
                <img *ngFor="let img of p.imageUrls" [src]="'http://localhost:8081' + img" alt="Product image" class="w-12 h-12 object-cover border rounded" />
              </div>
            </td>
            <td>{{ p.productStatus }}</td>
            <td>{{ p.stockQuantity }}</td>
            <td>{{ p.price | currency }}</td>
            <td>{{ p.categoryName }}</td>
            <td>
              <span *ngIf="p.variants?.length" class="text-blue-600">
                <button (click)="toggleVariants(p.id!)">
                  {{ isExpanded(p.id!) ? 'Hide' : 'Show' }}
                </button>
                <span *ngIf="hasVaryingPrices(p)" class="ml-2 text-orange-500">ðŸ’¡ Changing</span>
              </span>
            </td>
            <td>
              <button *ngIf="p.productStatus === 'ACTIVE'" (click)="deactivateProduct(p.id!)">KaldÄ±r</button>
              <button *ngIf="p.productStatus === 'INACTIVE' && p.stockQuantity > 0" (click)="activateProduct(p.id!)">YayÄ±na Al</button>
            </td>
            <td>
              <button (click)="editProduct(p)">DÃ¼zenle</button>
              <button *ngIf="p.productStatus === 'ACTIVE'" (click)="deactivateProduct(p.id!)">KaldÄ±r</button>
              <button *ngIf="p.productStatus === 'INACTIVE' && p.stockQuantity > 0" (click)="activateProduct(p.id!)">YayÄ±na Al</button>
            </td>

          </tr>

          <!-- Varyantlar -->
          <ng-container *ngIf="isExpanded(p.id!) && p.variants?.length">
            <tr *ngFor="let v of p.variants">
              <td colspan="7" class="pl-6 text-sm text-gray-700">
                <strong>Varyant:</strong>
                Renk: {{ v.color }}, Beden: {{ v.size }},
                Fiyat: {{ v.price | currency }}, Stok: {{ v.stock }}
                <div class="flex gap-2 mt-1">
                  <img *ngFor="let img of v.imageUrls" [src]="img" alt="Variant image" class="w-12 h-12 object-cover border rounded" />
                </div>
              </td>
            </tr>
          </ng-container>
        </ng-container>
      </tbody>
    </table>
  </div>

  <p *ngIf="filteredProducts.length === 0" class="no-products">No products found for this filter.</p>
</div>
